{% extends "base.html" %}
{% block title %}Modifier Vente{% endblock %}

{% block content %}
<div class="container mt-3">

  <h4 class="text-primary mb-3">
    âœï¸ Modifier la vente #{{ vente.id }}
  </h4>

  <form method="post"
        action="{{ url_for('modifier_vente', vente_id=vente.id) }}">

    <!-- CLIENT -->
    <div class="row mb-3">
      <div class="col-md-4">
        <label class="form-label fw-bold">Client</label>
        <select name="client_id" class="form-select" required>
          {% for c in clients %}
            <option value="{{ c.id }}"
              {% if c.id == vente.client_id %}selected{% endif %}>
              {{ c.nom_client }}
            </option>
          {% endfor %}
        </select>
      </div>
    </div>

    <!-- LIGNES DE VENTE -->
    <table class="table table-bordered">
      <thead class="table-light">
        <tr>
          <th>Produit</th>
          <th>Lot</th>
          <th width="120">QuantitÃ©</th>
          <th width="150">Prix unitaire</th>
        </tr>
      </thead>
      <tbody>

      {% for ligne in vente.lignes %}
        <tr>
          <td>
            {{ ligne.stock.produit.nom_produit }}
          </td>

          <td>
            {{ ligne.stock.numero_lot }}
            <input type="hidden"
                   name="stock_id[]"
                   value="{{ ligne.stock.id }}">
          </td>

          <td>
            <input type="number"
                   name="quantite[]"
                   class="form-control"
                   min="1"
                   value="{{ ligne.quantite }}"
                   required>
          </td>

          <td>
            <input type="number"
                   name="prix_unitaire[]"
                   class="form-control"
                   min="0"
                   step="0.01"
                   value="{{ ligne.prix_unitaire }}"
                   required>
          </td>
        </tr>
      {% endfor %}

      </tbody>
    </table>

    <!-- ACTIONS -->
    <div class="d-flex justify-content-end gap-2 mt-3">
      <button type="submit" class="btn btn-success">
        ğŸ’¾ Enregistrer
      </button>
      <a href="{{ url_for('nouvelle_vente') }}"
         class="btn btn-secondary">
        Annuler
      </a>
    </div>

  </form>

</div>
{% endblock %}
